<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>PassFace: Face Recognition Using OpenCV | mozanunal.com</title><meta name=keywords content="Image Processing,EmguCV,opencv,Eigenfaces,Face recognition,Fisgerfaces"><meta name=description content="Hi,
PassFace is a face recognizing program develop using EmguCV (OpenCV wrapper). It is possible to use 4 different algorithm and 3 different source(Camera, Video, Image) in this program. Most of the tryings have been made using LFW data set which have 13000 pictures of 1500 different people.Details of project can be reached below:
Source Code: https://github.com/mozanunal/PassFace
{% youtube d6LI42NEZZY? %}
1. Introduction
Definition of the Problem
In this project, a program is going to develop to recognize the faces and compare them the faces it learned and give the identity of the person. All this identifying system is going to work in real time. Main subjects in this project are image processing and machine learning. Project aim to develop some algorithm to detect faces specifically recognize the faces using pattern recognition algorithms. The number of faces and the equipment needed is going to be determined according to test of different algorithms."><meta name=author content="Mehmet Ozan Ünal"><link rel=canonical href=https://mozanunal.com/2016/06/passface-face-recognition-using-opencv/><meta name=google-site-verification content="G-007KSW65JL"><link crossorigin=anonymous href=/assets/css/stylesheet.8fe10233a706bc87f2e08b3cf97b8bd4c0a80f10675a143675d59212121037c0.css integrity="sha256-j+ECM6cGvIfy4Is8+XuL1MCoDxBnWhQ2ddWSEhIQN8A=" rel="preload stylesheet" as=style><link rel=icon href=https://mozanunal.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://mozanunal.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://mozanunal.com/favicon-32x32.png><link rel=apple-touch-icon href=https://mozanunal.com/apple-touch-icon.png><link rel=mask-icon href=https://mozanunal.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://mozanunal.com/2016/06/passface-face-recognition-using-opencv/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js onload='renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"\\\\[",right:"\\\\]",display:!0},{left:"$",right:"$",display:!1},{left:"\\\\(",right:"\\\\)",display:!1}],throwOnError:!1})'></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-007KSW65JL"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-007KSW65JL")}</script><meta property="og:url" content="https://mozanunal.com/2016/06/passface-face-recognition-using-opencv/"><meta property="og:site_name" content="mozanunal.com"><meta property="og:title" content="PassFace: Face Recognition Using OpenCV"><meta property="og:description" content="Hi,
PassFace is a face recognizing program develop using EmguCV (OpenCV wrapper). It is possible to use 4 different algorithm and 3 different source(Camera, Video, Image) in this program. Most of the tryings have been made using LFW data set which have 13000 pictures of 1500 different people.Details of project can be reached below:
Source Code: https://github.com/mozanunal/PassFace
{% youtube d6LI42NEZZY? %}
1. Introduction Definition of the Problem In this project, a program is going to develop to recognize the faces and compare them the faces it learned and give the identity of the person. All this identifying system is going to work in real time. Main subjects in this project are image processing and machine learning. Project aim to develop some algorithm to detect faces specifically recognize the faces using pattern recognition algorithms. The number of faces and the equipment needed is going to be determined according to test of different algorithms."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2016-06-04T19:50:00+00:00"><meta property="article:modified_time" content="2016-06-04T19:50:00+00:00"><meta property="article:tag" content="Image Processing"><meta property="article:tag" content="EmguCV"><meta property="article:tag" content="Opencv"><meta property="article:tag" content="Eigenfaces"><meta property="article:tag" content="Face Recognition"><meta property="article:tag" content="Fisgerfaces"><meta property="og:image" content="https://mozanunal.com/images/papermod-cover.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://mozanunal.com/images/papermod-cover.png"><meta name=twitter:title content="PassFace: Face Recognition Using OpenCV"><meta name=twitter:description content="Hi,
PassFace is a face recognizing program develop using EmguCV (OpenCV wrapper). It is possible to use 4 different algorithm and 3 different source(Camera, Video, Image) in this program. Most of the tryings have been made using LFW data set which have 13000 pictures of 1500 different people.Details of project can be reached below:
Source Code: https://github.com/mozanunal/PassFace
{% youtube d6LI42NEZZY? %}
1. Introduction
Definition of the Problem
In this project, a program is going to develop to recognize the faces and compare them the faces it learned and give the identity of the person. All this identifying system is going to work in real time. Main subjects in this project are image processing and machine learning. Project aim to develop some algorithm to detect faces specifically recognize the faces using pattern recognition algorithms. The number of faces and the equipment needed is going to be determined according to test of different algorithms."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://mozanunal.com/posts/"},{"@type":"ListItem","position":2,"name":"PassFace: Face Recognition Using OpenCV","item":"https://mozanunal.com/2016/06/passface-face-recognition-using-opencv/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"PassFace: Face Recognition Using OpenCV","name":"PassFace: Face Recognition Using OpenCV","description":"Hi,\nPassFace is a face recognizing program develop using EmguCV (OpenCV wrapper). It is possible to use 4 different algorithm and 3 different source(Camera, Video, Image) in this program. Most of the tryings have been made using LFW data set which have 13000 pictures of 1500 different people.Details of project can be reached below:\nSource Code: https://github.com/mozanunal/PassFace\n{% youtube d6LI42NEZZY? %}\n1. Introduction Definition of the Problem In this project, a program is going to develop to recognize the faces and compare them the faces it learned and give the identity of the person. All this identifying system is going to work in real time. Main subjects in this project are image processing and machine learning. Project aim to develop some algorithm to detect faces specifically recognize the faces using pattern recognition algorithms. The number of faces and the equipment needed is going to be determined according to test of different algorithms.\n","keywords":["Image Processing","EmguCV","opencv","Eigenfaces","Face recognition","Fisgerfaces"],"articleBody":"Hi,\nPassFace is a face recognizing program develop using EmguCV (OpenCV wrapper). It is possible to use 4 different algorithm and 3 different source(Camera, Video, Image) in this program. Most of the tryings have been made using LFW data set which have 13000 pictures of 1500 different people.Details of project can be reached below:\nSource Code: https://github.com/mozanunal/PassFace\n{% youtube d6LI42NEZZY? %}\n1. Introduction Definition of the Problem In this project, a program is going to develop to recognize the faces and compare them the faces it learned and give the identity of the person. All this identifying system is going to work in real time. Main subjects in this project are image processing and machine learning. Project aim to develop some algorithm to detect faces specifically recognize the faces using pattern recognition algorithms. The number of faces and the equipment needed is going to be determined according to test of different algorithms.\nMotivation To detect identity of person from images is very beneficial subject. It can provide easy access to users. It can be used for detect criminals and prevent potential crimes. Also I see this subject in a lot of industrial projects and academic researches. I want to work with real world problem and problem which is not completely solved. Therefore I decided to work with this project.\nDifficulties of Problem Main difficulties can be sorted like below:\nFaces are not completely rigid objects so it is hard to recognize them. The more person in database needs more and more processing power. Blurry images because of real time system The effects of ambient light Changes in person’s face over time Data Sets AT\u0026T Facedatabase\nThe AT\u0026T Face Database, sometimes also referred to as ORL Database of Faces, contains ten different images of each of 40 distinct subjects. For some subjects, the images were taken at different times, varying the lighting, facial expressions (open / closed eyes, smiling / not smiling) and facial details (glasses / no glasses). All the images were taken against a dark homogeneous background with the subjects in an upright, frontal position (with tolerance for some side movement).\nYale Facedatabase A\nalso known as Yalefaces. The AT\u0026T Face Database is good for initial tests, but it’s a fairly easy database. The Eigenfaces method already has a 97% recognition rate on it, so you won’t see any great improvements with other algorithms. The Yale Face Database A (also known as Yalefaces) is a more appropriate dataset for initial experiments, because the recognition problem is harder. The database consists of 15 people (14 male, 1 female) each with 11 grayscale images sized 320x243 pixel. There are changes in the light conditions (center light, left light, right light), facial expressions (happy, normal, sad, sleepy, surprised, wink) and glasses (glasses, no-glasses).\nLabeled Faces in the Wild\nA database of face photographs designed for studying the problem of unconstrained face recognition. The data set contains more than 13,000 images of faces collected from the web. Each face has been labeled with the name of the person pictured. 1680 of the people pictured have two or more distinct photos in the data set. The only constraint on these faces is that they were detected by the Viola-Jones face detector..\nProgramming Environment and Libraries Visual Studio IDE is used for project. The program is written in C# using OpenCV libraries.\n2. Face Recognition Algorithm Face Detection Face Detection is not the main subject of this project but to create database and to increase the face recognition performance. Opencv’s Haar Cascade Classifier function is used. In this function a haar cascade file ,which is pre learned for face detection, is used.\nMorphologic Operations Ambient light and the movement at faces are the challenging problems in face recognition. Therefore some morphologic operators is applied to the faces to decrease the effect of these problems. In this project equalize histogram function of opencv is used to decrease the effect of the ambient light.\nSURF Feature Extractor 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 if (comboBoxAlgorithm.Text == “SURF Feature Extractor”) { string dataDirectory=Directory.GetCurrentDirectory()+”\\TrainedFaces”; string[] files = Directory.GetFiles(dataDirectory, “*.jpeg”, SearchOption.AllDirectories); foreach (var file in files) { richTextBox1.Text += file.ToString(); long recpoints; ImagesampleImage = new Image(file); secondImageBox.Image = sampleImage; using (Image modelImage = sampleImage.Convert()) using (Image observedImage = image.Convert()) { Image result = SurfRecognizer.Draw(modelImage, observedImage, out recpoints); //captureImageBox.Image = observedImage; if (recpoints \u003e 10) { MCvFont f = new MCvFont(Emgu.CV.CvEnum.FONT.CV_FONT_HERSHEY_COMPLEX, 1.0, 1.0); result.Draw(“Person Recognited, Welcome”, ref f, new Point(40, 40), new Bgr(0, 255, 0)); ImageViewer.Show(result, String.Format(“ {0} Points Recognited”, recpoints)); } } } Eigenfaces 1 2 3 4 5 6 7 8 9 10 11 12 13 14 else if (comboBoxAlgorithm.Text == \"EigenFaces\") { //image._EqualizeHist(); if (eqHisChecked.Checked == true) { image._EqualizeHist(); } var result = eigenFaceRecognizer.Predict(image.Convert().Resize(100, 100, Emgu.CV.CvEnum.INTER.CV_INTER_CUBIC)); if (result.Label != -1) { image.Draw(eigenlabels[result.Label].ToString(), ref font, new Point(face.X - 2, face.Y - 2), new Bgr(Color.LightGreen)); label6.Text = result.Distance.ToString(); } } Fisherfaces 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 else if (comboBoxAlgorithm.Text == \"FisherFaces\") { if (eqHisChecked.Checked == true) { image._EqualizeHist(); } var result = fisherFaceRecognizer.Predict(image.Convert().Resize(100, 100, Emgu.CV.CvEnum.INTER.CV_INTER_CUBIC)); if (result.Label != -1) { image.Draw(fisherlabels[result.Label].ToString(), ref font, new Point(face.X - 2, face.Y - 2), new Bgr(Color.LightGreen)); label6.Text = result.Distance.ToString(); } } Local Binary Patterns Histograms 1 2 3 4 5 6 7 8 9 10 11 12 13 else if (comboBoxAlgorithm.Text == \"LBPHFaces\") { if (eqHisChecked.Checked == true) { image._EqualizeHist(); } var result = lbphFaceRecognizer.Predict(image.Convert().Resize(100, 100, Emgu.CV.CvEnum.INTER.CV_INTER_CUBIC)); if (result.Label != -1) { image.Draw(lbphlabels[result.Label].ToString(), ref font, new Point(face.X - 2, face.Y - 2), new Bgr(Color.LightGreen)); label6.Text = result.Distance.ToString(); } } 3. PassFace Interface Database Creator A database creator is developed to make easier to implement and try different algorithm.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 Add DataBase Function private void addDatabaseButton_Click(object sender, EventArgs e) { //Take time for save filename string fileName = textBox1.Text+\"_\"+DateTime.Now.Day.ToString() + \"-\" + DateTime.Now.Month.ToString() + \"-\" + DateTime.Now.Year.ToString() + \"-\" + DateTime.Now.Hour.ToString() + \"-\" + DateTime.Now.Minute.ToString()+\"-\" + DateTime.Now.Second.ToString()+\".jpeg\"; //First The faces in the Image is detected Image image = _capture.RetrieveBgrFrame().Resize(400, 300, Emgu.CV.CvEnum.INTER.CV_INTER_CUBIC); List faces = new List(); List eyes = new List(); long detectionTime; DetectFace.Detect(image, \"haarcascade_frontalface_default.xml\", \"haarcascade_eye.xml\", faces, eyes, out detectionTime); foreach (Rectangle face in faces) { image.ROI = face; } Directory.CreateDirectory(\"TrainedFaces\"); image.Resize(100, 100, Emgu.CV.CvEnum.INTER.CV_INTER_CUBIC).ToBitmap().Save(\"TrainedFaces\\\\\" + fileName); } private void comboBoxAlgorithm_SelectedIndexChanged(object sender, EventArgs e) { if (comboBoxAlgorithm.Text == \"EigenFaces\") { try { string dataDirectory = Directory.GetCurrentDirectory() + \"\\\\TrainedFaces\"; string[] files = Directory.GetFiles(dataDirectory, \"*.jpeg\", SearchOption.AllDirectories); eigenTrainedImageCounter = 0; foreach (var file in files) { Image TrainedImage=new Image(file); if (eqHisChecked.Checked == true) { TrainedImage._EqualizeHist(); } eigenTrainingImages.Add(TrainedImage.Convert()); eigenlabels.Add(fileName(file)); eigenIntlabels.Add(eigenTrainedImageCounter); eigenTrainedImageCounter++; richTextBox1.Text += fileName(file)+\"\\n\"; } eigenFaceRecognizer= new EigenFaceRecognizer(eigenTrainedImageCounter, 3000); eigenFaceRecognizer.Train(eigenTrainingImages.ToArray(), eigenIntlabels.ToArray()); } catch (Exception ex) { MessageBox.Show(ex.ToString()); MessageBox.Show(\"Nothing in binary database, please add at least a face(Simply train the prototype with the Add Face Button).\", \"Triained faces load\", MessageBoxButtons.OK, MessageBoxIcon.Exclamation); } } else if (comboBoxAlgorithm.Text == \"FisherFaces\") { try { string dataDirectory = Directory.GetCurrentDirectory() + \"\\\\TrainedFaces\"; string[] files = Directory.GetFiles(dataDirectory, \"*.jpeg\", SearchOption.AllDirectories); fisherTrainedImageCounter = 0; foreach (var file in files) { Image TrainedImage = new Image(file); fisherTrainingImages.Add(TrainedImage.Convert()); if (eqHisChecked.Checked == true) { TrainedImage._EqualizeHist(); } fisherlabels.Add(fileName(file)); fisherIntlabels.Add(fisherTrainedImageCounter); fisherTrainedImageCounter++; richTextBox1.Text += fileName(file) + \"\\n\"; } fisherFaceRecognizer = new FisherFaceRecognizer(fisherTrainedImageCounter, 3000); fisherFaceRecognizer.Train(fisherTrainingImages.ToArray(), fisherIntlabels.ToArray()); } catch (Exception ex) { MessageBox.Show(ex.ToString()); MessageBox.Show(\"Nothing in binary database, please add at least a face(Simply train the prototype with the Add Face Button).\", \"Triained faces load\", MessageBoxButtons.OK, MessageBoxIcon.Exclamation); } } else if (comboBoxAlgorithm.Text == \"LBPHFaces\") { try { string dataDirectory = Directory.GetCurrentDirectory() + \"\\\\TrainedFaces\"; string[] files = Directory.GetFiles(dataDirectory, \"*.jpeg\", SearchOption.AllDirectories); lbphTrainedImageCounter = 0; foreach (var file in files) { Image TrainedImage = new Image(file); if (eqHisChecked.Checked == true) { TrainedImage._EqualizeHist(); } lbphTrainingImages.Add(TrainedImage.Convert()); lbphlabels.Add(fileName(file)); lbphIntlabels.Add(lbphTrainedImageCounter); lbphTrainedImageCounter++; richTextBox1.Text += fileName(file) + \"\\n\"; } lbphFaceRecognizer = new LBPHFaceRecognizer(1, 8, 8, 8, 123.0); lbphFaceRecognizer.Train(lbphTrainingImages.ToArray(), lbphIntlabels.ToArray()); } catch (Exception ex) { MessageBox.Show(ex.ToString()); MessageBox.Show(\"Nothing in binary database, please add at least a face(Simply train the prototype with the Add Face Button).\", \"Triained faces load\", MessageBoxButtons.OK, MessageBoxIcon.Exclamation); } } } User Interface As a source camera, video, single image and multi image can be selected. Different source selection is developed using opencv and .net libraries.\n4. Future of PassFace Project Algorithm Accuracy Analysis Program designed for using different algorithms. But the comparison of these algorithms is not finished. The next step is implementing this algorithm the compare the algorithms accuracy and performance truly.\nPerformance Optimizations For fix the performance problems, develop the program for multiple core CPUs. For better performance, develop the program to run over GPU using CUDA libraries.\nAlgorithm Optimizations In these days, the most improved face recognition algorithms are using 3D face recognition technologies. It is based on; the 3D model of the faces are created using different 2D images. Therefore, the angle of looking and the direction of light are no longer be problem for these algorithms. The recognize operations are implementing using Neural Networks and Deep Learning Algorithms. It is planning to implement latest algorithms to increase accuracy in different conditions.\n5. Conclusion In this project, the main principles of the face recognition algorithms are learned. The performances and accuracies of the algorithms are compared. A gui application is developed to create database and process images using selected algorithm.\n","wordCount":"1641","inLanguage":"en","image":"https://mozanunal.com/images/papermod-cover.png","datePublished":"2016-06-04T19:50:00Z","dateModified":"2016-06-04T19:50:00Z","author":{"@type":"Person","name":"Mehmet Ozan Ünal"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://mozanunal.com/2016/06/passface-face-recognition-using-opencv/"},"publisher":{"@type":"Organization","name":"mozanunal.com","logo":{"@type":"ImageObject","url":"https://mozanunal.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://mozanunal.com/ accesskey=h title="mozanunal.com (Alt + H)">mozanunal.com</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://mozanunal.com/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://mozanunal.com/contact/ title=Contact><span>Contact</span></a></li><li><a href=https://github.com/mozanunal title=Github><span>Github</span>&nbsp;
<svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href="https://scholar.google.com/citations?user=u_HbXUUAAAAJ&amp;hl=en" title=GScholar><span>GScholar</span>&nbsp;
<svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://mozanunal.com/>Home</a>&nbsp;»&nbsp;<a href=https://mozanunal.com/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">PassFace: Face Recognition Using OpenCV</h1><div class=post-meta><span title='2016-06-04 19:50:00 +0000 UTC'>June 4, 2016</span>&nbsp;·&nbsp;8 min&nbsp;·&nbsp;Mehmet Ozan Ünal&nbsp;|&nbsp;<a href=https://github.com/mozanunal/mozanunal.github.io/tree/master/content/posts/passface-face-recognition-using-opencv.md rel="noopener noreferrer edit" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#1-introduction aria-label="1. Introduction">1. Introduction</a><ul><li><a href=#definition-of-the-problem aria-label="Definition of the Problem">Definition of the Problem</a></li><li><a href=#motivation aria-label=Motivation>Motivation</a></li><li><a href=#difficulties-of-problem aria-label="Difficulties of Problem">Difficulties of Problem</a></li><li><a href=#data-sets aria-label="Data Sets">Data Sets</a></li><li><a href=#programming-environment-and-libraries aria-label="Programming Environment and Libraries">Programming Environment and Libraries</a></li></ul></li><li><a href=#2-face-recognition-algorithm aria-label="2. Face Recognition Algorithm">2. Face Recognition Algorithm</a><ul><li><a href=#face-detection aria-label="Face Detection">Face Detection</a></li><li><a href=#morphologic-operations aria-label="Morphologic Operations">Morphologic Operations</a></li><li><a href=#surf-feature-extractor aria-label="SURF Feature Extractor">SURF Feature Extractor</a></li><li><a href=#eigenfaces aria-label=Eigenfaces>Eigenfaces</a></li><li><a href=#fisherfaces aria-label=Fisherfaces>Fisherfaces</a></li><li><a href=#local-binary-patterns-histograms aria-label="Local Binary Patterns Histograms">Local Binary Patterns Histograms</a></li></ul></li><li><a href=#3-passface-interface aria-label="3. PassFace Interface">3. PassFace Interface</a><ul><li><a href=#database-creator aria-label="Database Creator">Database Creator</a></li><li><a href=#user-interface aria-label="User Interface">User Interface</a></li></ul></li><li><a href=#4-future-of-passface-project aria-label="4. Future of PassFace Project">4. Future of PassFace Project</a><ul><li><a href=#algorithm-accuracy-analysis aria-label="Algorithm Accuracy Analysis">Algorithm Accuracy Analysis</a></li><li><a href=#performance-optimizations aria-label="Performance Optimizations">Performance Optimizations</a></li><li><a href=#algorithm-optimizations aria-label="Algorithm Optimizations">Algorithm Optimizations</a></li></ul></li><li><a href=#5-conclusion aria-label="5. Conclusion">5. Conclusion</a></li></ul></div></details></div><div class=post-content><p><strong>Hi,</strong><br>PassFace is a face recognizing program develop using EmguCV (OpenCV wrapper). It is possible to use 4 different algorithm and 3 different source(Camera, Video, Image) in this program. Most of the tryings have been made using LFW data set which have 13000 pictures of 1500 different people.Details of project can be reached below:</p><p>Source Code: <a href=https://github.com/mozanunal/PassFace>https://github.com/mozanunal/PassFace</a></p><p>{% youtube d6LI42NEZZY? %}</p><h4 id=1-introduction>1. Introduction<a hidden class=anchor aria-hidden=true href=#1-introduction>#</a></h4><h5 id=definition-of-the-problem>Definition of the Problem<a hidden class=anchor aria-hidden=true href=#definition-of-the-problem>#</a></h5><p>In this project, a program is going to develop to recognize the faces and compare them the faces it learned and give the identity of the person. All this identifying system is going to work in real time. Main subjects in this project are image processing and machine learning. Project aim to develop some algorithm to detect faces specifically recognize the faces using pattern recognition algorithms. The number of faces and the equipment needed is going to be determined according to test of different algorithms.</p><h5 id=motivation>Motivation<a hidden class=anchor aria-hidden=true href=#motivation>#</a></h5><p>To detect identity of person from images is very beneficial subject. It can provide easy access to users. It can be used for detect criminals and prevent potential crimes. Also I see this subject in a lot of industrial projects and academic researches. I want to work with real world problem and problem which is not completely solved. Therefore I decided to work with this project.</p><h5 id=difficulties-of-problem>Difficulties of Problem<a hidden class=anchor aria-hidden=true href=#difficulties-of-problem>#</a></h5><p>Main difficulties can be sorted like below:</p><ul><li>Faces are not completely rigid objects so it is hard to recognize them.</li><li>The more person in database needs more and more processing power.</li><li>Blurry images because of real time system</li><li>The effects of ambient light</li><li>Changes in person’s face over time</li></ul><h5 id=data-sets>Data Sets<a hidden class=anchor aria-hidden=true href=#data-sets>#</a></h5><p><a href=https://www.cl.cam.ac.uk/research/dtg/attarchive/facedatabase.html>AT&amp;T Facedatabase</a></p><p>The AT&amp;T Face Database, sometimes also referred to as ORL Database of Faces, contains ten different images of each of 40 distinct subjects. For some subjects, the images were taken at different times, varying the lighting, facial expressions (open / closed eyes, smiling / not smiling) and facial details (glasses / no glasses). All the images were taken against a dark homogeneous background with the subjects in an upright, frontal position (with tolerance for some side movement).</p><p><a href=https://vision.ucsd.edu/content/yale-face-database>Yale Facedatabase A</a></p><p>also known as Yalefaces. The AT&amp;T Face Database is good for initial tests, but it’s a fairly easy database. The Eigenfaces method already has a 97% recognition rate on it, so you won’t see any great improvements with other algorithms. The Yale Face Database A (also known as Yalefaces) is a more appropriate dataset for initial experiments, because the recognition problem is harder. The database consists of 15 people (14 male, 1 female) each with 11 grayscale images sized 320x243 <a href=https://lh3.googleusercontent.com/uNq7mPqspjvR267h-aZA2FS666Fl8Q8dXGhlg-Lzi7MJiNn5DkSyioK59Wj6pdA9h96bojY8L02LR-NIXIeuf0IjN-a6MYN7ufWHMOPqVbxd0hvoGcKsy0oR9jo5t85MGbfqOB9H></a>pixel. There are changes in the light conditions (center light, left light, right light), facial expressions (happy, normal, sad, sleepy, surprised, wink) and glasses (glasses, no-glasses).</p><p><a href>Labeled Faces in the Wild</a></p><p>A database of face photographs designed for studying the problem of unconstrained face recognition. The data set contains more than 13,000 images of faces collected from the web. Each face has been labeled with the name of the person pictured. 1680 of the people pictured have two or more distinct photos in the data set. The only constraint on these faces is that they were detected by the Viola-Jones face detector..</p><h5 id=programming-environment-and-libraries>Programming Environment and Libraries<a hidden class=anchor aria-hidden=true href=#programming-environment-and-libraries>#</a></h5><p>Visual Studio IDE is used for project. The program is written in C# using OpenCV libraries.</p><h4 id=2-face-recognition-algorithm>2. Face Recognition Algorithm<a hidden class=anchor aria-hidden=true href=#2-face-recognition-algorithm>#</a></h4><h5 id=face-detection>Face Detection<a hidden class=anchor aria-hidden=true href=#face-detection>#</a></h5><p>Face Detection is not the main subject of this project but to create database and to increase the face recognition performance. Opencv’s Haar Cascade Classifier function is used. In this function a haar cascade file ,which is pre learned for face detection, is used.</p><h5 id=morphologic-operations>Morphologic Operations<a hidden class=anchor aria-hidden=true href=#morphologic-operations>#</a></h5><p>Ambient light and the movement at faces are the challenging problems in face recognition. Therefore some morphologic operators is applied to the faces to decrease the effect of these problems. In this project equalize histogram function of opencv is used to decrease the effect of the ambient light.<img loading=lazy src=https://lh6.googleusercontent.com/3PMQmXghZyoi4dGekFhBS-QWqZDYEJpQ2o_yLXJgMEo3goTr6OqtrOSPYjtwgApKjKoAzXhFLE57R3TRDw8SWrXsod9PUCiHJXNndjoZ-Ui3P1xb0atKy0EvobLyy9cfVifzA0yT></p><h5 id=surf-feature-extractor>SURF Feature Extractor<a hidden class=anchor aria-hidden=true href=#surf-feature-extractor>#</a></h5><p><img loading=lazy src=https://lh5.googleusercontent.com/eRt6xx3RU22fZ22_-TGdan22lp2x7JiNA9De7PuYa2xLVcZIcg4hVJzvrXyzdNbocv4NuBW8QOHYYTr0NNowPys7QOScefuBrgEeoiILasaQm2v0S0P8NPxVYSiPBRoPotTP3h0p></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=n>comboBoxAlgorithm</span><span class=p>.</span><span class=n>Text</span> <span class=p>==</span> <span class=err>“</span><span class=n>SURF</span> <span class=n>Feature</span> <span class=n>Extractor</span><span class=err>”</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl><span class=kt>string</span> <span class=n>dataDirectory</span><span class=p>=</span><span class=n>Directory</span><span class=p>.</span><span class=n>GetCurrentDirectory</span><span class=p>()+</span><span class=err>”\</span><span class=n>TrainedFaces</span><span class=err>”</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>string</span><span class=p>[]</span> <span class=n>files</span> <span class=p>=</span> <span class=n>Directory</span><span class=p>.</span><span class=n>GetFiles</span><span class=p>(</span><span class=n>dataDirectory</span><span class=p>,</span> <span class=err>“</span><span class=p>*.</span><span class=n>jpeg</span><span class=err>”</span><span class=p>,</span> <span class=n>SearchOption</span><span class=p>.</span><span class=n>AllDirectories</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>foreach</span> <span class=p>(</span><span class=kt>var</span> <span class=n>file</span> <span class=k>in</span> <span class=n>files</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>   <span class=n>richTextBox1</span><span class=p>.</span><span class=n>Text</span> <span class=p>+=</span> <span class=n>file</span><span class=p>.</span><span class=n>ToString</span><span class=p>();</span>
</span></span><span class=line><span class=cl>   <span class=kt>long</span> <span class=n>recpoints</span><span class=p>;</span>
</span></span><span class=line><span class=cl>   <span class=n>ImagesampleImage</span> <span class=p>=</span> <span class=k>new</span> <span class=n>Image</span><span class=p>(</span><span class=n>file</span><span class=p>);</span>
</span></span><span class=line><span class=cl>   <span class=n>secondImageBox</span><span class=p>.</span><span class=n>Image</span> <span class=p>=</span> <span class=n>sampleImage</span><span class=p>;</span>
</span></span><span class=line><span class=cl>   <span class=k>using</span> <span class=p>(</span><span class=n>Image</span> <span class=n>modelImage</span> <span class=p>=</span> <span class=n>sampleImage</span><span class=p>.</span><span class=n>Convert</span><span class=p>())</span>
</span></span><span class=line><span class=cl>   <span class=k>using</span> <span class=p>(</span><span class=n>Image</span> <span class=n>observedImage</span> <span class=p>=</span> <span class=n>image</span><span class=p>.</span><span class=n>Convert</span><span class=p>())</span>
</span></span><span class=line><span class=cl>   <span class=p>{</span>
</span></span><span class=line><span class=cl>       <span class=n>Image</span> <span class=n>result</span> <span class=p>=</span> <span class=n>SurfRecognizer</span><span class=p>.</span><span class=n>Draw</span><span class=p>(</span><span class=n>modelImage</span><span class=p>,</span> <span class=n>observedImage</span><span class=p>,</span> <span class=k>out</span> <span class=n>recpoints</span><span class=p>);</span>
</span></span><span class=line><span class=cl>       <span class=c1>//captureImageBox.Image = observedImage;</span>
</span></span><span class=line><span class=cl>       <span class=k>if</span> <span class=p>(</span><span class=n>recpoints</span> <span class=p>&gt;</span> <span class=m>10</span><span class=p>)</span>
</span></span><span class=line><span class=cl>       <span class=p>{</span>
</span></span><span class=line><span class=cl>           <span class=n>MCvFont</span> <span class=n>f</span> <span class=p>=</span> <span class=k>new</span> <span class=n>MCvFont</span><span class=p>(</span><span class=n>Emgu</span><span class=p>.</span><span class=n>CV</span><span class=p>.</span><span class=n>CvEnum</span><span class=p>.</span><span class=n>FONT</span><span class=p>.</span><span class=n>CV_FONT_HERSHEY_COMPLEX</span><span class=p>,</span> <span class=m>1.0</span><span class=p>,</span> <span class=m>1.0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>           <span class=n>result</span><span class=p>.</span><span class=n>Draw</span><span class=p>(</span><span class=err>“</span><span class=n>Person</span> <span class=n>Recognited</span><span class=p>,</span> <span class=n>Welcome</span><span class=err>”</span><span class=p>,</span> <span class=k>ref</span> <span class=n>f</span><span class=p>,</span> <span class=k>new</span> <span class=n>Point</span><span class=p>(</span><span class=m>40</span><span class=p>,</span> <span class=m>40</span><span class=p>),</span> <span class=k>new</span> <span class=n>Bgr</span><span class=p>(</span><span class=m>0</span><span class=p>,</span> <span class=m>255</span><span class=p>,</span> <span class=m>0</span><span class=p>));</span>
</span></span><span class=line><span class=cl>           <span class=n>ImageViewer</span><span class=p>.</span><span class=n>Show</span><span class=p>(</span><span class=n>result</span><span class=p>,</span> <span class=n>String</span><span class=p>.</span><span class=n>Format</span><span class=p>(</span><span class=err>“</span> <span class=p>{</span><span class=m>0</span><span class=p>}</span> <span class=n>Points</span> <span class=n>Recognited</span><span class=err>”</span><span class=p>,</span> <span class=n>recpoints</span><span class=p>));</span>
</span></span><span class=line><span class=cl>       <span class=p>}</span>
</span></span><span class=line><span class=cl>   <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=eigenfaces>Eigenfaces<a hidden class=anchor aria-hidden=true href=#eigenfaces>#</a></h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>comboBoxAlgorithm</span><span class=p>.</span><span class=n>Text</span> <span class=p>==</span> <span class=s>&#34;EigenFaces&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>   <span class=c1>//image._EqualizeHist();</span>
</span></span><span class=line><span class=cl>   <span class=k>if</span> <span class=p>(</span><span class=n>eqHisChecked</span><span class=p>.</span><span class=n>Checked</span> <span class=p>==</span> <span class=kc>true</span><span class=p>)</span>
</span></span><span class=line><span class=cl>   <span class=p>{</span>
</span></span><span class=line><span class=cl>       <span class=n>image</span><span class=p>.</span><span class=n>_EqualizeHist</span><span class=p>();</span>
</span></span><span class=line><span class=cl>   <span class=p>}</span>
</span></span><span class=line><span class=cl>   <span class=kt>var</span> <span class=n>result</span> <span class=p>=</span> <span class=n>eigenFaceRecognizer</span><span class=p>.</span><span class=n>Predict</span><span class=p>(</span><span class=n>image</span><span class=p>.</span><span class=n>Convert</span><span class=p>().</span><span class=n>Resize</span><span class=p>(</span><span class=m>100</span><span class=p>,</span> <span class=m>100</span><span class=p>,</span> <span class=n>Emgu</span><span class=p>.</span><span class=n>CV</span><span class=p>.</span><span class=n>CvEnum</span><span class=p>.</span><span class=n>INTER</span><span class=p>.</span><span class=n>CV_INTER_CUBIC</span><span class=p>));</span>
</span></span><span class=line><span class=cl>   <span class=k>if</span> <span class=p>(</span><span class=n>result</span><span class=p>.</span><span class=n>Label</span> <span class=p>!=</span> <span class=p>-</span><span class=m>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>   <span class=p>{</span>
</span></span><span class=line><span class=cl>       <span class=n>image</span><span class=p>.</span><span class=n>Draw</span><span class=p>(</span><span class=n>eigenlabels</span><span class=p>[</span><span class=n>result</span><span class=p>.</span><span class=n>Label</span><span class=p>].</span><span class=n>ToString</span><span class=p>(),</span> <span class=k>ref</span> <span class=n>font</span><span class=p>,</span> <span class=k>new</span> <span class=n>Point</span><span class=p>(</span><span class=n>face</span><span class=p>.</span><span class=n>X</span> <span class=p>-</span> <span class=m>2</span><span class=p>,</span> <span class=n>face</span><span class=p>.</span><span class=n>Y</span> <span class=p>-</span> <span class=m>2</span><span class=p>),</span> <span class=k>new</span> <span class=n>Bgr</span><span class=p>(</span><span class=n>Color</span><span class=p>.</span><span class=n>LightGreen</span><span class=p>));</span>
</span></span><span class=line><span class=cl>       <span class=n>label6</span><span class=p>.</span><span class=n>Text</span> <span class=p>=</span> <span class=n>result</span><span class=p>.</span><span class=n>Distance</span><span class=p>.</span><span class=n>ToString</span><span class=p>();</span>
</span></span><span class=line><span class=cl>   <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=fisherfaces>Fisherfaces<a hidden class=anchor aria-hidden=true href=#fisherfaces>#</a></h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>comboBoxAlgorithm</span><span class=p>.</span><span class=n>Text</span> <span class=p>==</span> <span class=s>&#34;FisherFaces&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>   <span class=k>if</span> <span class=p>(</span><span class=n>eqHisChecked</span><span class=p>.</span><span class=n>Checked</span> <span class=p>==</span> <span class=kc>true</span><span class=p>)</span>
</span></span><span class=line><span class=cl>   <span class=p>{</span>
</span></span><span class=line><span class=cl>       <span class=n>image</span><span class=p>.</span><span class=n>_EqualizeHist</span><span class=p>();</span>
</span></span><span class=line><span class=cl>   <span class=p>}</span>
</span></span><span class=line><span class=cl>   <span class=kt>var</span> <span class=n>result</span> <span class=p>=</span> <span class=n>fisherFaceRecognizer</span><span class=p>.</span><span class=n>Predict</span><span class=p>(</span><span class=n>image</span><span class=p>.</span><span class=n>Convert</span><span class=p>().</span><span class=n>Resize</span><span class=p>(</span><span class=m>100</span><span class=p>,</span> <span class=m>100</span><span class=p>,</span> <span class=n>Emgu</span><span class=p>.</span><span class=n>CV</span><span class=p>.</span><span class=n>CvEnum</span><span class=p>.</span><span class=n>INTER</span><span class=p>.</span><span class=n>CV_INTER_CUBIC</span><span class=p>));</span>
</span></span><span class=line><span class=cl>   <span class=k>if</span> <span class=p>(</span><span class=n>result</span><span class=p>.</span><span class=n>Label</span> <span class=p>!=</span> <span class=p>-</span><span class=m>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>   <span class=p>{</span>
</span></span><span class=line><span class=cl>       <span class=n>image</span><span class=p>.</span><span class=n>Draw</span><span class=p>(</span><span class=n>fisherlabels</span><span class=p>[</span><span class=n>result</span><span class=p>.</span><span class=n>Label</span><span class=p>].</span><span class=n>ToString</span><span class=p>(),</span> <span class=k>ref</span> <span class=n>font</span><span class=p>,</span> <span class=k>new</span> <span class=n>Point</span><span class=p>(</span><span class=n>face</span><span class=p>.</span><span class=n>X</span> <span class=p>-</span> <span class=m>2</span><span class=p>,</span> <span class=n>face</span><span class=p>.</span><span class=n>Y</span> <span class=p>-</span> <span class=m>2</span><span class=p>),</span> <span class=k>new</span> <span class=n>Bgr</span><span class=p>(</span><span class=n>Color</span><span class=p>.</span><span class=n>LightGreen</span><span class=p>));</span>
</span></span><span class=line><span class=cl>       <span class=n>label6</span><span class=p>.</span><span class=n>Text</span> <span class=p>=</span> <span class=n>result</span><span class=p>.</span><span class=n>Distance</span><span class=p>.</span><span class=n>ToString</span><span class=p>();</span>
</span></span><span class=line><span class=cl>   <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=local-binary-patterns-histograms>Local Binary Patterns Histograms<a hidden class=anchor aria-hidden=true href=#local-binary-patterns-histograms>#</a></h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>comboBoxAlgorithm</span><span class=p>.</span><span class=n>Text</span> <span class=p>==</span> <span class=s>&#34;LBPHFaces&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>   <span class=k>if</span> <span class=p>(</span><span class=n>eqHisChecked</span><span class=p>.</span><span class=n>Checked</span> <span class=p>==</span> <span class=kc>true</span><span class=p>)</span>
</span></span><span class=line><span class=cl>   <span class=p>{</span>
</span></span><span class=line><span class=cl>       <span class=n>image</span><span class=p>.</span><span class=n>_EqualizeHist</span><span class=p>();</span>
</span></span><span class=line><span class=cl>   <span class=p>}</span>
</span></span><span class=line><span class=cl>   <span class=kt>var</span> <span class=n>result</span> <span class=p>=</span> <span class=n>lbphFaceRecognizer</span><span class=p>.</span><span class=n>Predict</span><span class=p>(</span><span class=n>image</span><span class=p>.</span><span class=n>Convert</span><span class=p>().</span><span class=n>Resize</span><span class=p>(</span><span class=m>100</span><span class=p>,</span> <span class=m>100</span><span class=p>,</span> <span class=n>Emgu</span><span class=p>.</span><span class=n>CV</span><span class=p>.</span><span class=n>CvEnum</span><span class=p>.</span><span class=n>INTER</span><span class=p>.</span><span class=n>CV_INTER_CUBIC</span><span class=p>));</span>
</span></span><span class=line><span class=cl>   <span class=k>if</span> <span class=p>(</span><span class=n>result</span><span class=p>.</span><span class=n>Label</span> <span class=p>!=</span> <span class=p>-</span><span class=m>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>   <span class=p>{</span>
</span></span><span class=line><span class=cl>       <span class=n>image</span><span class=p>.</span><span class=n>Draw</span><span class=p>(</span><span class=n>lbphlabels</span><span class=p>[</span><span class=n>result</span><span class=p>.</span><span class=n>Label</span><span class=p>].</span><span class=n>ToString</span><span class=p>(),</span> <span class=k>ref</span> <span class=n>font</span><span class=p>,</span> <span class=k>new</span> <span class=n>Point</span><span class=p>(</span><span class=n>face</span><span class=p>.</span><span class=n>X</span> <span class=p>-</span> <span class=m>2</span><span class=p>,</span> <span class=n>face</span><span class=p>.</span><span class=n>Y</span> <span class=p>-</span> <span class=m>2</span><span class=p>),</span> <span class=k>new</span> <span class=n>Bgr</span><span class=p>(</span><span class=n>Color</span><span class=p>.</span><span class=n>LightGreen</span><span class=p>));</span>
</span></span><span class=line><span class=cl>       <span class=n>label6</span><span class=p>.</span><span class=n>Text</span> <span class=p>=</span> <span class=n>result</span><span class=p>.</span><span class=n>Distance</span><span class=p>.</span><span class=n>ToString</span><span class=p>();</span>
</span></span><span class=line><span class=cl>   <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=3-passface-interface>3. PassFace Interface<a hidden class=anchor aria-hidden=true href=#3-passface-interface>#</a></h4><h5 id=database-creator>Database Creator<a hidden class=anchor aria-hidden=true href=#database-creator>#</a></h5><p>A database creator is developed to make easier to implement and try different algorithm.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=n>Add</span> <span class=n>DataBase</span> <span class=n>Function</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>private</span> <span class=k>void</span> <span class=n>addDatabaseButton_Click</span><span class=p>(</span><span class=kt>object</span> <span class=n>sender</span><span class=p>,</span> <span class=n>EventArgs</span> <span class=n>e</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>   <span class=c1>//Take time for save filename</span>
</span></span><span class=line><span class=cl>   <span class=kt>string</span> <span class=n>fileName</span> <span class=p>=</span> <span class=n>textBox1</span><span class=p>.</span><span class=n>Text</span><span class=p>+</span><span class=s>&#34;_&#34;</span><span class=p>+</span><span class=n>DateTime</span><span class=p>.</span><span class=n>Now</span><span class=p>.</span><span class=n>Day</span><span class=p>.</span><span class=n>ToString</span><span class=p>()</span> <span class=p>+</span> <span class=s>&#34;-&#34;</span> <span class=p>+</span> <span class=n>DateTime</span><span class=p>.</span><span class=n>Now</span><span class=p>.</span><span class=n>Month</span><span class=p>.</span><span class=n>ToString</span><span class=p>()</span> <span class=p>+</span> <span class=s>&#34;-&#34;</span> <span class=p>+</span> <span class=n>DateTime</span><span class=p>.</span><span class=n>Now</span><span class=p>.</span><span class=n>Year</span><span class=p>.</span><span class=n>ToString</span><span class=p>()</span>
</span></span><span class=line><span class=cl>   <span class=p>+</span> <span class=s>&#34;-&#34;</span> <span class=p>+</span> <span class=n>DateTime</span><span class=p>.</span><span class=n>Now</span><span class=p>.</span><span class=n>Hour</span><span class=p>.</span><span class=n>ToString</span><span class=p>()</span> <span class=p>+</span> <span class=s>&#34;-&#34;</span> <span class=p>+</span> <span class=n>DateTime</span><span class=p>.</span><span class=n>Now</span><span class=p>.</span><span class=n>Minute</span><span class=p>.</span><span class=n>ToString</span><span class=p>()+</span><span class=s>&#34;-&#34;</span> <span class=p>+</span> <span class=n>DateTime</span><span class=p>.</span><span class=n>Now</span><span class=p>.</span><span class=n>Second</span><span class=p>.</span><span class=n>ToString</span><span class=p>()+</span><span class=s>&#34;.jpeg&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   <span class=c1>//First The faces in the Image is detected</span>
</span></span><span class=line><span class=cl>   <span class=n>Image</span> <span class=n>image</span> <span class=p>=</span> <span class=n>_capture</span><span class=p>.</span><span class=n>RetrieveBgrFrame</span><span class=p>().</span><span class=n>Resize</span><span class=p>(</span><span class=m>400</span><span class=p>,</span> <span class=m>300</span><span class=p>,</span> <span class=n>Emgu</span><span class=p>.</span><span class=n>CV</span><span class=p>.</span><span class=n>CvEnum</span><span class=p>.</span><span class=n>INTER</span><span class=p>.</span><span class=n>CV_INTER_CUBIC</span><span class=p>);</span>
</span></span><span class=line><span class=cl>   <span class=n>List</span> <span class=n>faces</span> <span class=p>=</span> <span class=k>new</span> <span class=n>List</span><span class=p>();</span>
</span></span><span class=line><span class=cl>   <span class=n>List</span> <span class=n>eyes</span> <span class=p>=</span> <span class=k>new</span> <span class=n>List</span><span class=p>();</span>
</span></span><span class=line><span class=cl>   <span class=kt>long</span> <span class=n>detectionTime</span><span class=p>;</span>
</span></span><span class=line><span class=cl>   <span class=n>DetectFace</span><span class=p>.</span><span class=n>Detect</span><span class=p>(</span><span class=n>image</span><span class=p>,</span> <span class=s>&#34;haarcascade_frontalface_default.xml&#34;</span><span class=p>,</span> <span class=s>&#34;haarcascade_eye.xml&#34;</span><span class=p>,</span> <span class=n>faces</span><span class=p>,</span> <span class=n>eyes</span><span class=p>,</span> <span class=k>out</span> <span class=n>detectionTime</span><span class=p>);</span>
</span></span><span class=line><span class=cl>   <span class=k>foreach</span> <span class=p>(</span><span class=n>Rectangle</span> <span class=n>face</span> <span class=k>in</span> <span class=n>faces</span><span class=p>)</span>
</span></span><span class=line><span class=cl>   <span class=p>{</span>
</span></span><span class=line><span class=cl>       <span class=n>image</span><span class=p>.</span><span class=n>ROI</span> <span class=p>=</span> <span class=n>face</span><span class=p>;</span>
</span></span><span class=line><span class=cl>   <span class=p>}</span>
</span></span><span class=line><span class=cl>   <span class=n>Directory</span><span class=p>.</span><span class=n>CreateDirectory</span><span class=p>(</span><span class=s>&#34;TrainedFaces&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>   <span class=n>image</span><span class=p>.</span><span class=n>Resize</span><span class=p>(</span><span class=m>100</span><span class=p>,</span> <span class=m>100</span><span class=p>,</span> <span class=n>Emgu</span><span class=p>.</span><span class=n>CV</span><span class=p>.</span><span class=n>CvEnum</span><span class=p>.</span><span class=n>INTER</span><span class=p>.</span><span class=n>CV_INTER_CUBIC</span><span class=p>).</span><span class=n>ToBitmap</span><span class=p>().</span><span class=n>Save</span><span class=p>(</span><span class=s>&#34;TrainedFaces\\&#34;</span> <span class=p>+</span> <span class=n>fileName</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>private</span> <span class=k>void</span> <span class=n>comboBoxAlgorithm_SelectedIndexChanged</span><span class=p>(</span><span class=kt>object</span> <span class=n>sender</span><span class=p>,</span> <span class=n>EventArgs</span> <span class=n>e</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>   <span class=k>if</span> <span class=p>(</span><span class=n>comboBoxAlgorithm</span><span class=p>.</span><span class=n>Text</span> <span class=p>==</span> <span class=s>&#34;EigenFaces&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>   <span class=p>{</span>
</span></span><span class=line><span class=cl>       <span class=k>try</span>
</span></span><span class=line><span class=cl>       <span class=p>{</span>
</span></span><span class=line><span class=cl>         <span class=kt>string</span> <span class=n>dataDirectory</span> <span class=p>=</span> <span class=n>Directory</span><span class=p>.</span><span class=n>GetCurrentDirectory</span><span class=p>()</span> <span class=p>+</span> <span class=s>&#34;\\TrainedFaces&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>         <span class=kt>string</span><span class=p>[]</span> <span class=n>files</span> <span class=p>=</span> <span class=n>Directory</span><span class=p>.</span><span class=n>GetFiles</span><span class=p>(</span><span class=n>dataDirectory</span><span class=p>,</span> <span class=s>&#34;*.jpeg&#34;</span><span class=p>,</span> <span class=n>SearchOption</span><span class=p>.</span><span class=n>AllDirectories</span><span class=p>);</span>
</span></span><span class=line><span class=cl>         <span class=n>eigenTrainedImageCounter</span> <span class=p>=</span> <span class=m>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>         <span class=k>foreach</span> <span class=p>(</span><span class=kt>var</span> <span class=n>file</span> <span class=k>in</span> <span class=n>files</span><span class=p>)</span>
</span></span><span class=line><span class=cl>         <span class=p>{</span>
</span></span><span class=line><span class=cl>               <span class=n>Image</span> <span class=n>TrainedImage</span><span class=p>=</span><span class=k>new</span> <span class=n>Image</span><span class=p>(</span><span class=n>file</span><span class=p>);</span>
</span></span><span class=line><span class=cl>               <span class=k>if</span> <span class=p>(</span><span class=n>eqHisChecked</span><span class=p>.</span><span class=n>Checked</span> <span class=p>==</span> <span class=kc>true</span><span class=p>)</span>
</span></span><span class=line><span class=cl>               <span class=p>{</span>
</span></span><span class=line><span class=cl>                   <span class=n>TrainedImage</span><span class=p>.</span><span class=n>_EqualizeHist</span><span class=p>();</span>
</span></span><span class=line><span class=cl>               <span class=p>}</span>
</span></span><span class=line><span class=cl>               <span class=n>eigenTrainingImages</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>TrainedImage</span><span class=p>.</span><span class=n>Convert</span><span class=p>());</span>
</span></span><span class=line><span class=cl>               <span class=n>eigenlabels</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>fileName</span><span class=p>(</span><span class=n>file</span><span class=p>));</span>
</span></span><span class=line><span class=cl>               <span class=n>eigenIntlabels</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>eigenTrainedImageCounter</span><span class=p>);</span>
</span></span><span class=line><span class=cl>               <span class=n>eigenTrainedImageCounter</span><span class=p>++;</span>
</span></span><span class=line><span class=cl>               <span class=n>richTextBox1</span><span class=p>.</span><span class=n>Text</span> <span class=p>+=</span> <span class=n>fileName</span><span class=p>(</span><span class=n>file</span><span class=p>)+</span><span class=s>&#34;\n&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>         <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=n>eigenFaceRecognizer</span><span class=p>=</span> <span class=k>new</span> <span class=n>EigenFaceRecognizer</span><span class=p>(</span><span class=n>eigenTrainedImageCounter</span><span class=p>,</span> <span class=m>3000</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          <span class=n>eigenFaceRecognizer</span><span class=p>.</span><span class=n>Train</span><span class=p>(</span><span class=n>eigenTrainingImages</span><span class=p>.</span><span class=n>ToArray</span><span class=p>(),</span> <span class=n>eigenIntlabels</span><span class=p>.</span><span class=n>ToArray</span><span class=p>());</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>       <span class=p>}</span>
</span></span><span class=line><span class=cl>       <span class=k>catch</span> <span class=p>(</span><span class=n>Exception</span> <span class=n>ex</span><span class=p>)</span>
</span></span><span class=line><span class=cl>       <span class=p>{</span>
</span></span><span class=line><span class=cl>           <span class=n>MessageBox</span><span class=p>.</span><span class=n>Show</span><span class=p>(</span><span class=n>ex</span><span class=p>.</span><span class=n>ToString</span><span class=p>());</span>
</span></span><span class=line><span class=cl>           <span class=n>MessageBox</span><span class=p>.</span><span class=n>Show</span><span class=p>(</span><span class=s>&#34;Nothing in binary database, please add at least a face(Simply train the prototype with the Add Face Button).&#34;</span><span class=p>,</span> <span class=s>&#34;Triained faces load&#34;</span><span class=p>,</span> <span class=n>MessageBoxButtons</span><span class=p>.</span><span class=n>OK</span><span class=p>,</span> <span class=n>MessageBoxIcon</span><span class=p>.</span><span class=n>Exclamation</span><span class=p>);</span>
</span></span><span class=line><span class=cl>       <span class=p>}</span>
</span></span><span class=line><span class=cl>   <span class=p>}</span>
</span></span><span class=line><span class=cl>   <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>comboBoxAlgorithm</span><span class=p>.</span><span class=n>Text</span> <span class=p>==</span> <span class=s>&#34;FisherFaces&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>   <span class=p>{</span>
</span></span><span class=line><span class=cl>       <span class=k>try</span>
</span></span><span class=line><span class=cl>       <span class=p>{</span>
</span></span><span class=line><span class=cl>           <span class=kt>string</span> <span class=n>dataDirectory</span> <span class=p>=</span> <span class=n>Directory</span><span class=p>.</span><span class=n>GetCurrentDirectory</span><span class=p>()</span> <span class=p>+</span> <span class=s>&#34;\\TrainedFaces&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>           <span class=kt>string</span><span class=p>[]</span> <span class=n>files</span> <span class=p>=</span> <span class=n>Directory</span><span class=p>.</span><span class=n>GetFiles</span><span class=p>(</span><span class=n>dataDirectory</span><span class=p>,</span> <span class=s>&#34;*.jpeg&#34;</span><span class=p>,</span> <span class=n>SearchOption</span><span class=p>.</span><span class=n>AllDirectories</span><span class=p>);</span>
</span></span><span class=line><span class=cl>           <span class=n>fisherTrainedImageCounter</span> <span class=p>=</span> <span class=m>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>           <span class=k>foreach</span> <span class=p>(</span><span class=kt>var</span> <span class=n>file</span> <span class=k>in</span> <span class=n>files</span><span class=p>)</span>
</span></span><span class=line><span class=cl>           <span class=p>{</span>
</span></span><span class=line><span class=cl>               <span class=n>Image</span> <span class=n>TrainedImage</span> <span class=p>=</span> <span class=k>new</span> <span class=n>Image</span><span class=p>(</span><span class=n>file</span><span class=p>);</span>
</span></span><span class=line><span class=cl>               <span class=n>fisherTrainingImages</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>TrainedImage</span><span class=p>.</span><span class=n>Convert</span><span class=p>());</span>
</span></span><span class=line><span class=cl>               <span class=k>if</span> <span class=p>(</span><span class=n>eqHisChecked</span><span class=p>.</span><span class=n>Checked</span> <span class=p>==</span> <span class=kc>true</span><span class=p>)</span>
</span></span><span class=line><span class=cl>               <span class=p>{</span>
</span></span><span class=line><span class=cl>                   <span class=n>TrainedImage</span><span class=p>.</span><span class=n>_EqualizeHist</span><span class=p>();</span>
</span></span><span class=line><span class=cl>               <span class=p>}</span>
</span></span><span class=line><span class=cl>               <span class=n>fisherlabels</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>fileName</span><span class=p>(</span><span class=n>file</span><span class=p>));</span>
</span></span><span class=line><span class=cl>               <span class=n>fisherIntlabels</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>fisherTrainedImageCounter</span><span class=p>);</span>
</span></span><span class=line><span class=cl>               <span class=n>fisherTrainedImageCounter</span><span class=p>++;</span>
</span></span><span class=line><span class=cl>               <span class=n>richTextBox1</span><span class=p>.</span><span class=n>Text</span> <span class=p>+=</span> <span class=n>fileName</span><span class=p>(</span><span class=n>file</span><span class=p>)</span> <span class=p>+</span> <span class=s>&#34;\n&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>           <span class=p>}</span>
</span></span><span class=line><span class=cl>           <span class=n>fisherFaceRecognizer</span> <span class=p>=</span> <span class=k>new</span> <span class=n>FisherFaceRecognizer</span><span class=p>(</span><span class=n>fisherTrainedImageCounter</span><span class=p>,</span> <span class=m>3000</span><span class=p>);</span>
</span></span><span class=line><span class=cl>           <span class=n>fisherFaceRecognizer</span><span class=p>.</span><span class=n>Train</span><span class=p>(</span><span class=n>fisherTrainingImages</span><span class=p>.</span><span class=n>ToArray</span><span class=p>(),</span> <span class=n>fisherIntlabels</span><span class=p>.</span><span class=n>ToArray</span><span class=p>());</span>
</span></span><span class=line><span class=cl>       <span class=p>}</span>
</span></span><span class=line><span class=cl>       <span class=k>catch</span> <span class=p>(</span><span class=n>Exception</span> <span class=n>ex</span><span class=p>)</span>
</span></span><span class=line><span class=cl>       <span class=p>{</span>
</span></span><span class=line><span class=cl>           <span class=n>MessageBox</span><span class=p>.</span><span class=n>Show</span><span class=p>(</span><span class=n>ex</span><span class=p>.</span><span class=n>ToString</span><span class=p>());</span>
</span></span><span class=line><span class=cl>           <span class=n>MessageBox</span><span class=p>.</span><span class=n>Show</span><span class=p>(</span><span class=s>&#34;Nothing in binary database, please add at least a face(Simply train the prototype with the Add Face Button).&#34;</span><span class=p>,</span> <span class=s>&#34;Triained faces load&#34;</span><span class=p>,</span> <span class=n>MessageBoxButtons</span><span class=p>.</span><span class=n>OK</span><span class=p>,</span> <span class=n>MessageBoxIcon</span><span class=p>.</span><span class=n>Exclamation</span><span class=p>);</span>
</span></span><span class=line><span class=cl>       <span class=p>}</span>
</span></span><span class=line><span class=cl>   <span class=p>}</span>
</span></span><span class=line><span class=cl>   <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>comboBoxAlgorithm</span><span class=p>.</span><span class=n>Text</span> <span class=p>==</span> <span class=s>&#34;LBPHFaces&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>   <span class=p>{</span>
</span></span><span class=line><span class=cl>       <span class=k>try</span>
</span></span><span class=line><span class=cl>       <span class=p>{</span>
</span></span><span class=line><span class=cl>           <span class=kt>string</span> <span class=n>dataDirectory</span> <span class=p>=</span> <span class=n>Directory</span><span class=p>.</span><span class=n>GetCurrentDirectory</span><span class=p>()</span> <span class=p>+</span> <span class=s>&#34;\\TrainedFaces&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>           <span class=kt>string</span><span class=p>[]</span> <span class=n>files</span> <span class=p>=</span> <span class=n>Directory</span><span class=p>.</span><span class=n>GetFiles</span><span class=p>(</span><span class=n>dataDirectory</span><span class=p>,</span> <span class=s>&#34;*.jpeg&#34;</span><span class=p>,</span> <span class=n>SearchOption</span><span class=p>.</span><span class=n>AllDirectories</span><span class=p>);</span>
</span></span><span class=line><span class=cl>           <span class=n>lbphTrainedImageCounter</span> <span class=p>=</span> <span class=m>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>           <span class=k>foreach</span> <span class=p>(</span><span class=kt>var</span> <span class=n>file</span> <span class=k>in</span> <span class=n>files</span><span class=p>)</span>
</span></span><span class=line><span class=cl>           <span class=p>{</span>
</span></span><span class=line><span class=cl>               <span class=n>Image</span> <span class=n>TrainedImage</span> <span class=p>=</span> <span class=k>new</span> <span class=n>Image</span><span class=p>(</span><span class=n>file</span><span class=p>);</span>
</span></span><span class=line><span class=cl>               <span class=k>if</span> <span class=p>(</span><span class=n>eqHisChecked</span><span class=p>.</span><span class=n>Checked</span> <span class=p>==</span> <span class=kc>true</span><span class=p>)</span>
</span></span><span class=line><span class=cl>               <span class=p>{</span>
</span></span><span class=line><span class=cl>                   <span class=n>TrainedImage</span><span class=p>.</span><span class=n>_EqualizeHist</span><span class=p>();</span>
</span></span><span class=line><span class=cl>               <span class=p>}</span>
</span></span><span class=line><span class=cl>               <span class=n>lbphTrainingImages</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>TrainedImage</span><span class=p>.</span><span class=n>Convert</span><span class=p>());</span>
</span></span><span class=line><span class=cl>               <span class=n>lbphlabels</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>fileName</span><span class=p>(</span><span class=n>file</span><span class=p>));</span>
</span></span><span class=line><span class=cl>               <span class=n>lbphIntlabels</span><span class=p>.</span><span class=n>Add</span><span class=p>(</span><span class=n>lbphTrainedImageCounter</span><span class=p>);</span>
</span></span><span class=line><span class=cl>               <span class=n>lbphTrainedImageCounter</span><span class=p>++;</span>
</span></span><span class=line><span class=cl>               <span class=n>richTextBox1</span><span class=p>.</span><span class=n>Text</span> <span class=p>+=</span> <span class=n>fileName</span><span class=p>(</span><span class=n>file</span><span class=p>)</span> <span class=p>+</span> <span class=s>&#34;\n&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>           <span class=p>}</span>
</span></span><span class=line><span class=cl>           <span class=n>lbphFaceRecognizer</span> <span class=p>=</span> <span class=k>new</span> <span class=n>LBPHFaceRecognizer</span><span class=p>(</span><span class=m>1</span><span class=p>,</span> <span class=m>8</span><span class=p>,</span> <span class=m>8</span><span class=p>,</span> <span class=m>8</span><span class=p>,</span> <span class=m>123.0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>           <span class=n>lbphFaceRecognizer</span><span class=p>.</span><span class=n>Train</span><span class=p>(</span><span class=n>lbphTrainingImages</span><span class=p>.</span><span class=n>ToArray</span><span class=p>(),</span> <span class=n>lbphIntlabels</span><span class=p>.</span><span class=n>ToArray</span><span class=p>());</span>
</span></span><span class=line><span class=cl>       <span class=p>}</span>
</span></span><span class=line><span class=cl>       <span class=k>catch</span> <span class=p>(</span><span class=n>Exception</span> <span class=n>ex</span><span class=p>)</span>
</span></span><span class=line><span class=cl>       <span class=p>{</span>
</span></span><span class=line><span class=cl>           <span class=n>MessageBox</span><span class=p>.</span><span class=n>Show</span><span class=p>(</span><span class=n>ex</span><span class=p>.</span><span class=n>ToString</span><span class=p>());</span>
</span></span><span class=line><span class=cl>           <span class=n>MessageBox</span><span class=p>.</span><span class=n>Show</span><span class=p>(</span><span class=s>&#34;Nothing in binary database, please add at least a face(Simply train the prototype with the Add Face Button).&#34;</span><span class=p>,</span> <span class=s>&#34;Triained faces load&#34;</span><span class=p>,</span> <span class=n>MessageBoxButtons</span><span class=p>.</span><span class=n>OK</span><span class=p>,</span> <span class=n>MessageBoxIcon</span><span class=p>.</span><span class=n>Exclamation</span><span class=p>);</span>
</span></span><span class=line><span class=cl>       <span class=p>}</span>
</span></span><span class=line><span class=cl>   <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><img loading=lazy src=https://lh4.googleusercontent.com/560MflmHrYy5nUi4gIAQexc-Cdqfyr3GUej_g1wwa0HawxO4A7OFmOkgd0g4oBvy9An1PjiYxSM_8G0G2FS_zC2y3gWisgkr0NTikxv4oyDFL9qM6IpkupdhA7OjnUAb4cuy51Pa></p><h5 id=user-interface>User Interface<a hidden class=anchor aria-hidden=true href=#user-interface>#</a></h5><p>As a source camera, video, single image and multi image can be selected. Different source selection is developed using opencv and .net libraries.</p><p><img loading=lazy src=https://lh5.googleusercontent.com/6y8Sx-7a4PDYcZWv9W_COKJf9EaGKQl-_3vc6q9oo-HzQeC4CJMJoGTceeaUAC4F31mjpGs84Zrkse1viHgwCCKnRvhciz7aEjmmySR16PAD2aOGmOrLWHr6R3hO7GvV0TamI9nS></p><h4 id=4-future-of-passface-project>4. Future of PassFace Project<a hidden class=anchor aria-hidden=true href=#4-future-of-passface-project>#</a></h4><h5 id=algorithm-accuracy-analysis>Algorithm Accuracy Analysis<a hidden class=anchor aria-hidden=true href=#algorithm-accuracy-analysis>#</a></h5><p>Program designed for using different algorithms. But the comparison of these algorithms is not finished. The next step is implementing this algorithm the compare the algorithms accuracy and performance truly.</p><h5 id=performance-optimizations>Performance Optimizations<a hidden class=anchor aria-hidden=true href=#performance-optimizations>#</a></h5><p>For fix the performance problems, develop the program for multiple core CPUs. For better performance, develop the program to run over GPU using CUDA libraries.</p><h5 id=algorithm-optimizations>Algorithm Optimizations<a hidden class=anchor aria-hidden=true href=#algorithm-optimizations>#</a></h5><p>In these days, the most improved face recognition algorithms are using 3D face recognition technologies. It is based on; the 3D model of the faces are created using different 2D images. Therefore, the angle of looking and the direction of light are no longer be problem for these algorithms. The recognize operations are implementing using Neural Networks and Deep Learning Algorithms. It is planning to implement latest algorithms to increase accuracy in different conditions.</p><h4 id=5-conclusion>5. Conclusion<a hidden class=anchor aria-hidden=true href=#5-conclusion>#</a></h4><p>In this project, the main principles of the face recognition algorithms are learned. The performances and accuracies of the algorithms are compared. A gui application is developed to create database and process images using selected algorithm.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://mozanunal.com/tags/image-processing/>Image Processing</a></li><li><a href=https://mozanunal.com/tags/emgucv/>EmguCV</a></li><li><a href=https://mozanunal.com/tags/opencv/>Opencv</a></li><li><a href=https://mozanunal.com/tags/eigenfaces/>Eigenfaces</a></li><li><a href=https://mozanunal.com/tags/face-recognition/>Face Recognition</a></li><li><a href=https://mozanunal.com/tags/fisgerfaces/>Fisgerfaces</a></li></ul><nav class=paginav><a class=prev href=https://mozanunal.com/2016/06/wpf-ile-ev-otomasyonu-arayuzu/><span class=title>« Prev</span><br><span>[TR] WPF ile Ev Otomasyonu Arayüzü</span>
</a><a class=next href=https://mozanunal.com/2016/03/ayarlanabilir-tasnabilir-guc-kaynag-yapm/><span class=title>Next »</span><br><span>[TR] Ayarlanabilir Taşınabilir Güç Kaynağı Yapımı</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share PassFace: Face Recognition Using OpenCV on x" href="https://x.com/intent/tweet/?text=PassFace%3a%20Face%20Recognition%20Using%20OpenCV&amp;url=https%3a%2f%2fmozanunal.com%2f2016%2f06%2fpassface-face-recognition-using-opencv%2f&amp;hashtags=ImageProcessing%2cEmguCV%2copencv%2cEigenfaces%2cFacerecognition%2cFisgerfaces"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share PassFace: Face Recognition Using OpenCV on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fmozanunal.com%2f2016%2f06%2fpassface-face-recognition-using-opencv%2f&amp;title=PassFace%3a%20Face%20Recognition%20Using%20OpenCV&amp;summary=PassFace%3a%20Face%20Recognition%20Using%20OpenCV&amp;source=https%3a%2f%2fmozanunal.com%2f2016%2f06%2fpassface-face-recognition-using-opencv%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share PassFace: Face Recognition Using OpenCV on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fmozanunal.com%2f2016%2f06%2fpassface-face-recognition-using-opencv%2f&title=PassFace%3a%20Face%20Recognition%20Using%20OpenCV"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share PassFace: Face Recognition Using OpenCV on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fmozanunal.com%2f2016%2f06%2fpassface-face-recognition-using-opencv%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share PassFace: Face Recognition Using OpenCV on whatsapp" href="https://api.whatsapp.com/send?text=PassFace%3a%20Face%20Recognition%20Using%20OpenCV%20-%20https%3a%2f%2fmozanunal.com%2f2016%2f06%2fpassface-face-recognition-using-opencv%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share PassFace: Face Recognition Using OpenCV on telegram" href="https://telegram.me/share/url?text=PassFace%3a%20Face%20Recognition%20Using%20OpenCV&amp;url=https%3a%2f%2fmozanunal.com%2f2016%2f06%2fpassface-face-recognition-using-opencv%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentColor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share PassFace: Face Recognition Using OpenCV on ycombinator" href="https://news.ycombinator.com/submitlink?t=PassFace%3a%20Face%20Recognition%20Using%20OpenCV&u=https%3a%2f%2fmozanunal.com%2f2016%2f06%2fpassface-face-recognition-using-opencv%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>© mozanunal</span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>