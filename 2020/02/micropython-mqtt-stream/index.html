<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><link id=theme-style rel=stylesheet href=https://cdn.jsdelivr.net/gh/digitallytailored/classless@latest/classless.min.css><title>Micropython Mqtt Streamer | mozanunal.com</title><link rel=icon href=/favicon.svg type=image/svg+xml><link rel="shortcut icon" href=/favicon.ico><link rel=apple-touch-icon href=/apple-touch-icon.png></head><body><header><div class=header-content><div class=theme-selector><select id=theme-selector-input><option value=https://cdn.jsdelivr.net/gh/digitallytailored/classless@latest/classless.min.css>Classless.css</option><option value=https://cdn.jsdelivr.net/gh/cspablocortez/cosmocss@latest/cosmo.min.css>Cosmo.css</option><option value=https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.classless.min.css>Pico</option><option value=https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.fluid.classless.min.css>Pico-Fluid</option><option value=https://cdn.jsdelivr.net/npm/water.css@2/out/water.css>Water.css</option><option value=https://cdn.jsdelivr.net/npm/sakura.css/css/sakura.css>Sakura.css</option><option value=https://cdn.simplecss.org/simple.min.css>Simple.css</option><option value=https://cdn.jsdelivr.net/gh/alvaromontoro/almond.css@latest/dist/almond.min.css>Almond.css</option><option value=https://cdn.jsdelivr.net/npm/@exampledev/new.css@1.1.2/new.min.css>New.css</option><option value=https://unpkg.com/missing.css>Missing.css</option><option value=https://unpkg.com/boltcss/bolt.min.css>Bolt.css</option><option value=https://perfectmotherfuckingwebsite.com/fuckingstyle.css>PerfectMFWS</option><option value>HTML only</option></select></div><script>(function(){"use strict";const o=document.getElementById("theme-style"),e=document.getElementById("theme-selector-input"),n="hugo-classless-theme";function s(t){o.href=t,e&&(e.value=t)}const t=localStorage.getItem(n);if(t){const n=Array.from(e.options).some(e=>e.value===t);n&&s(t)}e&&e.addEventListener("change",()=>{const t=e.value;s(t),localStorage.setItem(n,t)})})()</script><nav><h3>mozanunal.com</h3><h4><a href=/>Home</a> | <a href=/posts/>Posts</a> | <a href=/projects/>Projects</a> | <a href=/contact/>Contact</a></h4></nav></div></header><main><article><header><h1>Micropython Mqtt Streamer</h1><p><em><time datetime=2020-02-26>February 26, 2020</time></em></p></header><div><h1 id=micropython-mqtt-streamer>Micropython Mqtt Streamer</h1><p>Hello everyone, I have developed a micropython code to stream accelerometer data
over mqtt. Also I have created a tool to visualize the data which is transferred
from remote MQTT device which is executing micropython code.</p><h2 id=demo>Demo</h2><div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden><iframe allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share; fullscreen" loading=eager referrerpolicy=strict-origin-when-cross-origin src="https://www.youtube.com/embed/5v9RwN818p8?autoplay=0&amp;controls=1&amp;end=0&amp;loop=0&amp;mute=0&amp;start=0" style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 title="YouTube video"></iframe></div><h2 id=development>Development</h2><p>The first thing which I tried with micropython is connecting ESP8266 to a WiFi.
I have tried the following script which I found from the official documentation
of the micropython.</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#c678dd>import</span> <span style=color:#e06c75>network</span>
</span></span><span style=display:flex><span><span style=color:#e06c75>wlan</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>network</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>WLAN</span>(<span style=color:#e06c75>network</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>STA_IF</span>)
</span></span><span style=display:flex><span><span style=color:#e06c75>wlan</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>active</span>(<span style=color:#e5c07b>True</span>)
</span></span><span style=display:flex><span><span style=color:#e06c75>wlan</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>connect</span>(<span style=color:#98c379>&#39;ssid&#39;</span>, <span style=color:#98c379>&#39;password&#39;</span>)
</span></span></code></pre></div><p>The wifi ip of the module can be examined with <code>wlan.ifconfig()</code> command. I
should say that scripting with a microcontoller is quite fun. ESP8266 was
connected over usb over Uart line to my computer and I can scripting using
micropython shell. For example: I have used upip module to install
<code>umqtt.simple</code> upython module to my ESP8266. After installing the umqtt module,
I have tested its basic examples and they worked without any problem.</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#56b6c2>&gt;&gt;&gt;</span> <span style=color:#c678dd>import</span> <span style=color:#e06c75>upip</span>
</span></span><span style=display:flex><span><span style=color:#56b6c2>&gt;&gt;&gt;</span> <span style=color:#e5c07b>dir</span>(<span style=color:#e06c75>upip</span>)
</span></span><span style=display:flex><span>[<span style=color:#98c379>&#39;__class__&#39;</span>, <span style=color:#98c379>&#39;__name__&#39;</span>, <span style=color:#98c379>&#39;errno&#39;</span>, <span style=color:#98c379>&#39;gc&#39;</span>, <span style=color:#98c379>&#39;help&#39;</span>, <span style=color:#98c379>&#39;json&#39;</span>, <span style=color:#98c379>&#39;os&#39;</span>, <span style=color:#98c379>&#39;sys&#39;</span>, <span style=color:#98c379>&#39;usocket&#39;</span>, <span style=color:#98c379>&#39;ussl&#39;</span>, <span style=color:#98c379>&#39;uzlib&#39;</span>, <span style=color:#98c379>&#39;main&#39;</span>, <span style=color:#98c379>&#39;debug&#39;</span>, <span style=color:#98c379>&#39;tarfile&#39;</span>, <span style=color:#98c379>&#39;install_path&#39;</span>, <span style=color:#98c379>&#39;cleanup_files&#39;</span>, <span style=color:#98c379>&#39;gzdict_sz&#39;</span>, <span style=color:#98c379>&#39;file_buf&#39;</span>, <span style=color:#98c379>&#39;NotFoundError&#39;</span>, <span style=color:#98c379>&#39;op_split&#39;</span>, <span style=color:#98c379>&#39;op_basename&#39;</span>, <span style=color:#98c379>&#39;_makedirs&#39;</span>, <span style=color:#98c379>&#39;save_file&#39;</span>, <span style=color:#98c379>&#39;install_tar&#39;</span>, <span style=color:#98c379>&#39;expandhome&#39;</span>, <span style=color:#98c379>&#39;warn_ussl&#39;</span>, <span style=color:#98c379>&#39;url_open&#39;</span>, <span style=color:#98c379>&#39;get_pkg_metadata&#39;</span>, <span style=color:#98c379>&#39;fatal&#39;</span>, <span style=color:#98c379>&#39;install_pkg&#39;</span>, <span style=color:#98c379>&#39;install&#39;</span>, <span style=color:#98c379>&#39;get_install_path&#39;</span>, <span style=color:#98c379>&#39;cleanup&#39;</span>]
</span></span><span style=display:flex><span><span style=color:#56b6c2>&gt;&gt;&gt;</span> <span style=color:#e06c75>upip</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>install</span>(<span style=color:#98c379>&#34;umqtt.simple&#34;</span>)
</span></span></code></pre></div><p>Next phase is reading data from accelerometer. I have used MPU6050 as the IMU
sensor. It consists a gyro and an accelerometer sensor. I have used i2c scanner
example code to detect the i2c address of the device. The address of my MPU6050
is <code>0x68</code>.</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#56b6c2>&gt;&gt;&gt;</span> <span style=color:#e06c75>i2c</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>scan</span>() 
</span></span><span style=display:flex><span><span style=color:#7f848e># scan for slaves on the bus, </span>
</span></span><span style=display:flex><span><span style=color:#7f848e># returning a list of valid addresses</span>
</span></span><span style=display:flex><span><span style=color:#56b6c2>&gt;&gt;&gt;</span> <span style=color:#c678dd>for</span> <span style=color:#e06c75>device</span> <span style=color:#56b6c2>in</span> <span style=color:#e06c75>devices</span>:
</span></span><span style=display:flex><span><span style=color:#56b6c2>...</span>     <span style=color:#e5c07b>print</span>(<span style=color:#98c379>&#34;Decimal address: &#34;</span>,<span style=color:#e06c75>device</span>,<span style=color:#98c379>&#34; | Hexa address: &#34;</span>,<span style=color:#e5c07b>hex</span>(<span style=color:#e06c75>device</span>))
</span></span><span style=display:flex><span><span style=color:#56b6c2>...</span>
</span></span><span style=display:flex><span><span style=color:#56b6c2>...</span>
</span></span><span style=display:flex><span><span style=color:#56b6c2>...</span>
</span></span><span style=display:flex><span><span style=color:#e06c75>Decimal</span> <span style=color:#e06c75>address</span>:  <span style=color:#d19a66>104</span>  <span style=color:#56b6c2>|</span> <span style=color:#e06c75>Hexa</span> <span style=color:#e06c75>address</span>:  <span style=color:#d19a66>0x68</span>
</span></span></code></pre></div><p>The following class is developed to read sensor values directly from MPU6050.</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#c678dd>import</span> <span style=color:#e06c75>machine</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#c678dd>class</span> <span style=color:#e5c07b>accel</span>():
</span></span><span style=display:flex><span>    <span style=color:#c678dd>def</span> <span style=color:#56b6c2;font-weight:700>__init__</span>(<span style=color:#e5c07b>self</span>, <span style=color:#e06c75>i2c</span>, <span style=color:#e06c75>addr</span><span style=color:#56b6c2>=</span><span style=color:#d19a66>0x68</span>):
</span></span><span style=display:flex><span>        <span style=color:#e5c07b>self</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>iic</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>i2c</span>
</span></span><span style=display:flex><span>        <span style=color:#e5c07b>self</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>addr</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>addr</span>
</span></span><span style=display:flex><span>        <span style=color:#e5c07b>self</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>iic</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>start</span>()
</span></span><span style=display:flex><span>        <span style=color:#e5c07b>self</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>iic</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>writeto</span>(<span style=color:#e5c07b>self</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>addr</span>, <span style=color:#e5c07b>bytearray</span>([<span style=color:#d19a66>107</span>, <span style=color:#d19a66>0</span>]))
</span></span><span style=display:flex><span>        <span style=color:#e5c07b>self</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>iic</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>stop</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#c678dd>def</span> <span style=color:#61afef;font-weight:700>get_raw_values</span>(<span style=color:#e5c07b>self</span>):
</span></span><span style=display:flex><span>        <span style=color:#e5c07b>self</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>iic</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>start</span>()
</span></span><span style=display:flex><span>        <span style=color:#e06c75>a</span> <span style=color:#56b6c2>=</span> <span style=color:#e5c07b>self</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>iic</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>readfrom_mem</span>(<span style=color:#e5c07b>self</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>addr</span>, <span style=color:#d19a66>0x3B</span>, <span style=color:#d19a66>14</span>)
</span></span><span style=display:flex><span>        <span style=color:#e5c07b>self</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>iic</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>stop</span>()
</span></span><span style=display:flex><span>        <span style=color:#c678dd>return</span> <span style=color:#e06c75>a</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#c678dd>def</span> <span style=color:#61afef;font-weight:700>get_ints</span>(<span style=color:#e5c07b>self</span>):
</span></span><span style=display:flex><span>        <span style=color:#e06c75>b</span> <span style=color:#56b6c2>=</span> <span style=color:#e5c07b>self</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>get_raw_values</span>()
</span></span><span style=display:flex><span>        <span style=color:#e06c75>c</span> <span style=color:#56b6c2>=</span> []
</span></span><span style=display:flex><span>        <span style=color:#c678dd>for</span> <span style=color:#e06c75>i</span> <span style=color:#56b6c2>in</span> <span style=color:#e06c75>b</span>:
</span></span><span style=display:flex><span>            <span style=color:#e06c75>c</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>append</span>(<span style=color:#e06c75>i</span>)
</span></span><span style=display:flex><span>        <span style=color:#c678dd>return</span> <span style=color:#e06c75>c</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#c678dd>def</span> <span style=color:#61afef;font-weight:700>bytes_toint</span>(<span style=color:#e5c07b>self</span>, <span style=color:#e06c75>firstbyte</span>, <span style=color:#e06c75>secondbyte</span>):
</span></span><span style=display:flex><span>        <span style=color:#c678dd>if</span> <span style=color:#56b6c2>not</span> <span style=color:#e06c75>firstbyte</span> <span style=color:#56b6c2>&amp;</span> <span style=color:#d19a66>0x80</span>:
</span></span><span style=display:flex><span>            <span style=color:#c678dd>return</span> <span style=color:#e06c75>firstbyte</span> <span style=color:#56b6c2>&lt;&lt;</span> <span style=color:#d19a66>8</span> <span style=color:#56b6c2>|</span> <span style=color:#e06c75>secondbyte</span>
</span></span><span style=display:flex><span>        <span style=color:#c678dd>return</span> <span style=color:#56b6c2>-</span> (((<span style=color:#e06c75>firstbyte</span> <span style=color:#56b6c2>^</span> <span style=color:#d19a66>255</span>) <span style=color:#56b6c2>&lt;&lt;</span> <span style=color:#d19a66>8</span>) <span style=color:#56b6c2>|</span> (<span style=color:#e06c75>secondbyte</span> <span style=color:#56b6c2>^</span> <span style=color:#d19a66>255</span>) <span style=color:#56b6c2>+</span> <span style=color:#d19a66>1</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#c678dd>def</span> <span style=color:#61afef;font-weight:700>get_values</span>(<span style=color:#e5c07b>self</span>):
</span></span><span style=display:flex><span>        <span style=color:#e06c75>raw_ints</span> <span style=color:#56b6c2>=</span> <span style=color:#e5c07b>self</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>get_raw_values</span>()
</span></span><span style=display:flex><span>        <span style=color:#e06c75>vals</span> <span style=color:#56b6c2>=</span> {}
</span></span><span style=display:flex><span>        <span style=color:#e06c75>vals</span>[<span style=color:#98c379>&#34;AcX&#34;</span>] <span style=color:#56b6c2>=</span> <span style=color:#e5c07b>self</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>bytes_toint</span>(<span style=color:#e06c75>raw_ints</span>[<span style=color:#d19a66>0</span>], <span style=color:#e06c75>raw_ints</span>[<span style=color:#d19a66>1</span>])
</span></span><span style=display:flex><span>        <span style=color:#e06c75>vals</span>[<span style=color:#98c379>&#34;AcY&#34;</span>] <span style=color:#56b6c2>=</span> <span style=color:#e5c07b>self</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>bytes_toint</span>(<span style=color:#e06c75>raw_ints</span>[<span style=color:#d19a66>2</span>], <span style=color:#e06c75>raw_ints</span>[<span style=color:#d19a66>3</span>])
</span></span><span style=display:flex><span>        <span style=color:#e06c75>vals</span>[<span style=color:#98c379>&#34;AcZ&#34;</span>] <span style=color:#56b6c2>=</span> <span style=color:#e5c07b>self</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>bytes_toint</span>(<span style=color:#e06c75>raw_ints</span>[<span style=color:#d19a66>4</span>], <span style=color:#e06c75>raw_ints</span>[<span style=color:#d19a66>5</span>])
</span></span><span style=display:flex><span>        <span style=color:#e06c75>vals</span>[<span style=color:#98c379>&#34;Tmp&#34;</span>] <span style=color:#56b6c2>=</span> <span style=color:#e5c07b>self</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>bytes_toint</span>(<span style=color:#e06c75>raw_ints</span>[<span style=color:#d19a66>6</span>], <span style=color:#e06c75>raw_ints</span>[<span style=color:#d19a66>7</span>]) <span style=color:#56b6c2>/</span> <span style=color:#d19a66>340.00</span> <span style=color:#56b6c2>+</span> <span style=color:#d19a66>36.53</span>
</span></span><span style=display:flex><span>        <span style=color:#e06c75>vals</span>[<span style=color:#98c379>&#34;GyX&#34;</span>] <span style=color:#56b6c2>=</span> <span style=color:#e5c07b>self</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>bytes_toint</span>(<span style=color:#e06c75>raw_ints</span>[<span style=color:#d19a66>8</span>], <span style=color:#e06c75>raw_ints</span>[<span style=color:#d19a66>9</span>])
</span></span><span style=display:flex><span>        <span style=color:#e06c75>vals</span>[<span style=color:#98c379>&#34;GyY&#34;</span>] <span style=color:#56b6c2>=</span> <span style=color:#e5c07b>self</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>bytes_toint</span>(<span style=color:#e06c75>raw_ints</span>[<span style=color:#d19a66>10</span>], <span style=color:#e06c75>raw_ints</span>[<span style=color:#d19a66>11</span>])
</span></span><span style=display:flex><span>        <span style=color:#e06c75>vals</span>[<span style=color:#98c379>&#34;GyZ&#34;</span>] <span style=color:#56b6c2>=</span> <span style=color:#e5c07b>self</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>bytes_toint</span>(<span style=color:#e06c75>raw_ints</span>[<span style=color:#d19a66>12</span>], <span style=color:#e06c75>raw_ints</span>[<span style=color:#d19a66>13</span>])
</span></span><span style=display:flex><span>        <span style=color:#c678dd>return</span> <span style=color:#e06c75>vals</span>  <span style=color:#7f848e># returned in range of Int16</span>
</span></span><span style=display:flex><span>        <span style=color:#7f848e># -32768 to 32767</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#c678dd>def</span> <span style=color:#61afef;font-weight:700>val_test</span>(<span style=color:#e5c07b>self</span>):  <span style=color:#7f848e># ONLY FOR TESTING! Also, fast reading sometimes crashes IIC</span>
</span></span><span style=display:flex><span>        <span style=color:#c678dd>from</span> <span style=color:#e06c75>time</span> <span style=color:#c678dd>import</span> <span style=color:#e06c75>sleep</span>
</span></span><span style=display:flex><span>        <span style=color:#c678dd>while</span> <span style=color:#d19a66>1</span>:
</span></span><span style=display:flex><span>            <span style=color:#e5c07b>print</span>(<span style=color:#e5c07b>self</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>get_values</span>())
</span></span><span style=display:flex><span>            <span style=color:#e06c75>sleep</span>(<span style=color:#d19a66>0.05</span>)
</span></span></code></pre></div><p>Main loop is also quite strait-forward. It read samples from acc and send these
over mqtt protocol directly to the server.</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#c678dd>from</span> <span style=color:#e06c75>machine</span> <span style=color:#c678dd>import</span> <span style=color:#e06c75>I2C</span>, <span style=color:#e06c75>Pin</span>
</span></span><span style=display:flex><span><span style=color:#c678dd>import</span> <span style=color:#e06c75>mpu6050</span>
</span></span><span style=display:flex><span><span style=color:#c678dd>from</span> <span style=color:#e06c75>umqtt.simple</span> <span style=color:#c678dd>import</span> <span style=color:#e06c75>MQTTClient</span>
</span></span><span style=display:flex><span><span style=color:#c678dd>import</span> <span style=color:#e06c75>time</span><span style=color:#56b6c2>,</span> <span style=color:#e06c75>json</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e06c75>i2c</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>I2C</span>(<span style=color:#e06c75>scl</span><span style=color:#56b6c2>=</span><span style=color:#e06c75>Pin</span>(<span style=color:#d19a66>5</span>), <span style=color:#e06c75>sda</span><span style=color:#56b6c2>=</span><span style=color:#e06c75>Pin</span>(<span style=color:#d19a66>4</span>))
</span></span><span style=display:flex><span><span style=color:#e06c75>accelerometer</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>mpu6050</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>accel</span>(<span style=color:#e06c75>i2c</span>)
</span></span><span style=display:flex><span><span style=color:#e06c75>c</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>MQTTClient</span>(<span style=color:#98c379>&#34;umqtt_client&#34;</span>, <span style=color:#98c379>&#34;iot.eclipse.org&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#e06c75>c</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>connect</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#c678dd>def</span> <span style=color:#61afef;font-weight:700>run</span>():
</span></span><span style=display:flex><span>    <span style=color:#c678dd>while</span> <span style=color:#e5c07b>True</span>:
</span></span><span style=display:flex><span>        <span style=color:#e06c75>c</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>publish</span>( <span style=color:#98c379>b</span><span style=color:#98c379>&#34;micropython/test/mpu6050&#34;</span>, <span style=color:#e06c75>json</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>dumps</span>(<span style=color:#e06c75>accelerometer</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>get_values</span>()) )
</span></span><span style=display:flex><span>        <span style=color:#e06c75>time</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>sleep_ms</span>(<span style=color:#d19a66>45</span>)
</span></span><span style=display:flex><span><span style=color:#e06c75>run</span>()
</span></span></code></pre></div><p><a href=https://github.com/mozanunal/micropython-mpu6050-mqtt-streamer>The code can be reached from this github repo.</a></p><h2 id=references>References</h2><ul><li><a href=https://randomnerdtutorials.com/micropython-mqtt-esp32-esp8266/>https://randomnerdtutorials.com/micropython-mqtt-esp32-esp8266/</a></li><li><a href=https://github.com/adamjezek98/MPU6050-ESP8266-MicroPython>https://github.com/adamjezek98/MPU6050-ESP8266-MicroPython</a> mpu6050.py</li><li><a href=https://docs.micropython.org/en/latest/library/network.WLAN.html>https://docs.micropython.org/en/latest/library/network.WLAN.html</a></li><li><a href=https://learn.adafruit.com/micropython-basics-esp8266-webrepl/access-webrepl>https://learn.adafruit.com/micropython-basics-esp8266-webrepl/access-webrepl</a></li></ul></div></article></main><footer><p>&copy; 2025 M.Ozan Unal.</p></footer></body><script async src="https://www.googletagmanager.com/gtag/js?id=G-007KSW65JL"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-007KSW65JL")}</script></html>