<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=description content="An example site for the clean and configurable Hugo Classless theme."><link href=/2020/03/hash-code-2020/ rel=alternate type=application/rss+xml title=mozanunal.com><link id=theme-style rel=stylesheet href=/css/classless.20c8e211f6768ba295effc3e101a31bfe248db7295bb122355bdf893c6cee731.css integrity="sha256-IMjiEfZ2i6KV7/w+EBoxv+JI23KVuxIjVb34k8bO5zE="><style>pre code,code{-webkit-text-size-adjust:100%;text-size-adjust:100%}pre code.hljs{all:revert;display:block;overflow-x:auto}img{display:block;margin-left:auto;margin-right:auto}figcaption{display:block;margin-left:auto;margin-right:auto}</style><title>Hash Code 2020 | mozanunal.com</title><link rel=icon href=/favicon.svg type=image/svg+xml><link rel="shortcut icon" href=/favicon.ico><link rel=apple-touch-icon href=/apple-touch-icon.png></head><body><header><div><h1>mozanunal.com</h1><nav><p><a href=/>Home</a> | <a href=/posts/>Posts</a> | <a href=/projects/>Projects</a> | <a href=/papers/>Papers</a> | <a href=/contact/>Contact</a></p></nav></div></header><main><article><header><h1>Hash Code 2020</h1><p><em><time datetime=2020-03-31>March 31, 2020</time></em></p></header><div><p><strong>Hello Everyone,</strong></p><p>I want to share our solution for Google Hash Code 2020. It is the code repo of
team titanium-white for Google Hash Code 2020 Online Qualification Round. We
have writen our code in Python.</p><p><a href=https://github.com/mozanunal/hashcode2020>Code can be reached from here</a></p><h2 id=code>Code</h2><p>Basically, the problem class is the backbone of the system.</p><ul><li>It handles the inputs and outputs with functions <code>__init__</code> and <code>dump</code>.</li><li>It read the input files and creates objects according to that. I think the one
of the thing we did well is this <code>__init__</code> function. It create all the
objects like books, libraries even if book2score dictionary.</li><li>It also handles the solving opeartion. It iterate trough the days and get max
predicted score from every library available. When the libraries calculating
the max pred scores, they get the current state as input. Therefore their
predictionsa are more accurate. After the library is selected the state is
updated such as day, already scanned books and state of the selected library.</li></ul><pre><code class=language-python># main.py
from library import Library, Book
import numpy as np

class Problem(object):
    def __init__(self, filename):
        print('file--', filename)
        f = open(filename)
        l = f.readline().split(' ')
        self.filename = filename
        self.nBooks, self.nLibs, self.nDays = int(l[0]), int(l[1]), int(l[2])
        self.books = [ Book(i,int(score)) for i, score in enumerate(f.readline().split(' '))]
        sumb = 0
        for b in self.books:
            sumb += b.score
        print( sumb/1000000 )
        self.book2Score = {book.id: int(book.score) for book in self.books}
        self.libs = []
        for libId in range(self.nLibs):
            l = [int(i) for i in f.readline().split(' ')]
            nBooks, nSign, nScan = l[0], l[1], l[2]
            books = [ Book(int(i), int(self.book2Score[int(i)])) for i in f.readline().split(' ') ] 
            lib = Library(libId, nBooks, nSign, nScan, books)
            self.libs.append(lib) 
        self.pri()

    def solve(self):
        t = 0
        solution = []
        readBookSet  = set()
        while t &lt; self.nDays:
            print('-----', t)
            scoreList = []
            readBookList = []
            for lib in self.libs:
                if lib.registered == False:
                    score, curBookList = lib.predMaxScore(self.nDays - t, readBookSet)
                    scoreList.append( score )
                    readBookList.append( curBookList )
                else:
                    scoreList.append(0)
                    readBookList.append( [ ] )
            if len(scoreList) == 0:
                break
            if max(scoreList) == 0:
                break
            libIndex = scoreList.index(max(scoreList))
            self.libs[libIndex].registeredDay = t
            self.libs[libIndex].registered = True
            self.libs[libIndex].solBooks = readBookList[libIndex]
            readBookSet = readBookSet.union(readBookList[libIndex])
            solution.append(self.libs[libIndex])
            t += self.libs[libIndex].nSign
        print([(lib.id, lib.nSign, lib.registeredDay) for lib in solution])
        return solution

    def dump(self, solution):
        f = open(self.filename.replace('data/', 'out/'), 'w+')
        f.write('{}\n'.format(len(solution)))
        for lib in solution:
            books = lib.solBooks
            f.write('{} {}\n'.format(
                lib.id, len(books)
            ))
            s = &quot;&quot;
            for book in books:
                s+= str(book) + ' '
            s+='\n'
            f.write(s)
        f.close()



    def pri(self):
        print('------')
        print(self.nBooks, self.nLibs, self.nDays)
        #print(self.libs)
        print('------')


if __name__ == &quot;__main__&quot;:
    p = Problem('data/a.txt')
    solution = p.solve()
    p.dump(solution)
</code></pre><p>The Second critical class is <code>Library</code> class. The vital function in our
implementation is predMaxScore. We are doing calculating this with
<code>total book score / (sign day*sign day)</code>. Because, during our experiments, we
saw that the sign days length is quite important especially for some datasets.
Total book score is simply if in that day the library is chosen, how much of the
books can be scanned until the end of total days. Of course these books are
selecting according to their scores and they should be not scanned before.</p><pre><code class=language-python># library.py
import operator

class Library(object):
    def __init__(self, idx, nBook, nSign, nScan, books):
        self.id = idx
        self.nBook = nBook
        self.nSign = nSign
        self.nScan = nScan
        self.books = list(reversed(sorted(books, key=operator.attrgetter('score')) ))
        self.tempBooks = self.books[:]
        self.registered = False
        self.registeredDay = None
        self.solBooks = []

    def predMaxScore(self, nDays, readBookSet):
        restDays  = nDays - self.nSign
        if restDays &lt; 0:
            return 0, []
        unReadBooks = set([book.id for book in self.tempBooks]) - readBookSet
        newBooks = []
        for book in self.tempBooks:
            if book.id in unReadBooks:
                newBooks.append(book)
        self.tempBooks = newBooks
        sumScore = 0 
        bookCap = restDays*self.nScan
        readBooks= self.tempBooks[:bookCap]
        readBooksId=[book.id for book in self.tempBooks[:bookCap]]
        for book in readBooks:
            sumScore += book.score
        return float(sumScore)/(float(self.nSign)**2), readBooksId

    def __repr__(self):
        return &quot;Lib[{}:{}:{}--{}]&quot;.format(self.nBook, self.nSign, self.nScan, self.books)


class Book(object):
    def __init__(self, id, score, scanned=False):
        self.id = id
        self.score = score

    def __repr__(self):
        return &quot;Book[{}:{}]&quot;.format(self.id, self.score)
</code></pre><h2 id=results>Results</h2><p>With these scores, we were 231th in the World and 7th in Turkey.</p><p><img src=https://raw.githubusercontent.com/mozanunal/hashcode2020/master/docs/result.jpeg alt></p><p><img src=https://raw.githubusercontent.com/mozanunal/hashcode2020/master/docs/score.jpeg alt></p><p>You can check out my posts about Hash Code 2017 and Hash Code 2018:</p><p><a href=https://mozanunal.com/2017/07/Google-Hash-Code-2017/>https://mozanunal.com/2017/07/Google-Hash-Code-2017/</a>
<a href=https://mozanunal.com/2018/04/hash-code-2018/>https://mozanunal.com/2018/04/hash-code-2018/</a></p><p>Hopefully, see you again. Thank you!</p></div></article></main><footer><p>&copy; 2025 M.Ozan Unal.</p></footer></body><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/highlight.js@11.11.0/styles/github.min.css media="(prefers-color-scheme: light)"><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/highlight.js@11.11.0/styles/github-dark.min.css media="(prefers-color-scheme: dark)"><script src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.11.1/build/highlight.min.js></script><script>hljs.highlightAll()</script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js onload='renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"\\\\[",right:"\\\\]",display:!0},{left:"$",right:"$",display:!1},{left:"\\\\(",right:"\\\\)",display:!1}],throwOnError:!1})'></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-007KSW65JL"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-007KSW65JL")}</script></html>